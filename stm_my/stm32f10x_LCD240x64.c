#include "syntax.h"

#include "stm32f10x_LCD240x64.h"

#include "hal_systimer.h"
#include "hal_lcd.h"

#include "debug.h"


#define Tire	0xAC	//0x8D
#define DTire	0x82


#include "control_gd.h"
#include "wtf.h"

// XXX: WTFS
extern uint16_t x_menu;
extern bool BlkW;
extern uchar Ad_Buf;
extern uchar AdinB;
extern uchar Mark;

extern char GrafView;

char lcdbuf[BufSize+10];  //TempEnd+6];

const uchar FirstScreen[40*64]={
    31,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,62,
    63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,
    53,63,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,59,
    63,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,62,42,43,
    63,63,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,31,59,
    63,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,42,42,43,
    62,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,14,43,
    58,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,43,
    62,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,43,
    58,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,
    58,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,43,
    58,32,0,1,62,12,31,63,60,63,60,3,56,8,7,62,1,62,12,7,33,60,3,63,63,63,56,15,48,60,7,62,63,59,63,0,0,0,1,23,
    58,0,0,0,24,22,4,24,24,24,28,3,32,24,4,50,0,24,22,24,24,28,3,33,33,33,32,3,3,3,4,50,12,8,49,32,0,0,0,43,
    58,0,0,0,24,38,4,24,24,24,22,5,32,28,4,50,0,24,38,24,24,22,5,33,33,33,32,3,3,3,4,50,12,8,49,32,0,0,1,23,
    48,0,0,0,24,32,4,24,24,56,22,5,32,44,0,48,0,24,32,48,12,22,5,33,33,33,32,3,6,1,32,48,12,32,49,32,0,0,0,3,
    58,0,0,0,25,0,4,24,25,24,22,5,32,38,0,48,0,25,0,48,12,22,5,33,33,33,32,3,6,1,32,48,12,32,49,32,0,0,1,23,
    48,0,0,0,31,32,4,24,25,24,19,9,32,38,0,48,0,31,32,48,12,19,9,33,33,33,63,3,62,1,32,48,15,32,63,0,0,0,0,3,
    48,0,0,0,25,32,4,24,26,24,19,9,33,3,0,48,0,25,32,48,12,19,9,33,33,33,33,35,6,1,32,48,12,32,48,0,0,0,1,23,
    48,0,0,0,24,48,4,24,28,24,19,17,33,63,0,48,60,24,48,48,12,19,17,33,33,33,33,35,6,1,32,48,12,32,48,0,0,0,0,3,
    48,0,0,0,24,49,36,24,24,24,17,49,33,3,32,48,0,24,48,24,24,17,49,33,33,33,33,35,3,3,0,48,12,8,48,0,0,0,0,7,
    48,0,0,0,24,25,40,24,24,24,17,33,34,1,32,48,0,24,24,24,24,17,33,33,33,33,33,35,3,3,0,48,12,8,48,0,0,0,0,3,
    48,0,0,1,62,31,49,63,60,63,60,39,63,35,51,60,1,62,30,7,33,60,39,63,51,63,63,15,48,60,3,60,63,59,60,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,1,63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,63,63,0,14,0,62,0,63,32,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,3,39,51,32,0,0,0,0,0,0,0,0,0,0,0,3,46,6,0,30,3,39,0,63,32,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,7,3,35,48,0,0,0,0,0,0,0,0,0,0,0,6,14,6,0,60,3,3,33,32,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,14,3,33,48,56,56,28,57,48,15,48,0,0,0,0,12,28,0,1,60,7,3,33,32,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,28,3,33,51,56,56,63,63,48,25,48,0,0,0,0,24,28,0,3,60,14,3,33,48,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,28,7,1,54,57,49,63,63,48,48,56,0,0,0,0,24,28,0,7,28,14,3,33,60,0,0,0,0,0,0,0,3,
    58,32,0,0,0,0,0,0,56,7,1,48,49,48,28,57,49,48,56,0,0,0,0,24,28,24,6,56,14,3,32,60,0,0,0,0,0,0,0,3,
    48,0,0,0,0,0,0,0,56,7,1,49,49,48,61,59,33,32,56,0,0,0,0,24,63,56,12,56,28,3,32,30,0,0,0,0,0,0,0,3,
    58,32,0,0,0,0,0,0,56,14,3,33,49,48,57,51,35,32,56,0,0,0,0,28,56,48,24,56,28,3,32,14,0,0,0,0,0,0,0,3,
    52,0,0,0,0,0,0,0,56,14,3,33,35,32,57,51,35,32,48,0,0,0,0,28,56,48,56,56,28,7,0,14,0,0,0,0,0,0,1,23,
    62,40,0,0,0,0,0,0,56,14,7,3,39,32,57,55,27,33,48,0,0,0,0,0,56,0,49,56,28,7,0,14,0,0,0,0,0,0,0,3,
    52,0,0,0,0,0,0,0,28,14,6,3,47,44,57,55,51,33,32,0,0,0,0,1,48,1,63,60,28,7,0,12,0,0,0,0,0,0,5,23,
    58,32,0,0,0,0,0,0,28,30,12,3,63,57,51,39,35,51,0,0,0,0,0,1,48,0,1,48,28,14,0,28,0,0,0,0,0,0,0,3,
    55,63,0,0,0,0,0,0,15,63,56,3,51,49,51,39,1,62,0,0,0,0,0,1,48,0,1,48,12,12,0,24,0,0,0,0,0,0,5,23,
    58,32,0,0,0,0,0,0,0,56,0,0,0,0,0,0,0,0,0,0,0,0,0,3,48,0,1,48,14,28,24,48,0,0,0,0,0,0,0,3,
    63,63,0,0,0,0,0,0,56,56,0,0,0,0,0,0,0,0,0,0,0,0,0,15,60,0,3,32,7,48,31,32,0,0,0,0,0,0,5,31,
    58,32,0,0,0,0,0,0,61,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,
    63,63,48,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,63,63,
    58,33,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,23,
    63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,63,59,
    58,45,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,23,
    63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,63,59,
    58,37,63,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,56,5,23,
    63,63,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,63,63,
    58,39,63,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,63,58,47,31,
    63,63,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,40,15,63,63,
    58,39,63,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,63,62,47,63,
    63,63,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,40,0,51,63,
    58,42,58,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,63,58,42,59,
    63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,
    63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,
};

const char ExtCG[]={
    0x3F,0x31,0x30,0x3E,0x31,0x31,0x3E,0x20,    //Б -                                                                                         160
    0x3F,0x31,0x30,0x30,0x30,0x30,0x30,0x20,    //Г -                                                                                         161
    0x20,0x20,0x1F,0x20,0x1F,0x20,0x20,0x20,    // ==                                                                                       162
    0x35,0x35,0x35,0x2E,0x35,0x35,0x35,0x20,    //Ж -                                                                                         163
    0x3E,0x21,0x21,0x2E,0x21,0x21,0x3E,0x20,    //З -                                                                                         164
    0x31,0x31,0x33,0x35,0x39,0x31,0x31,0x20,    //И -                                                                                         165
    0x2A,0x24,0x31,0x33,0x35,0x39,0x31,0x20,    //й -                                                                                         166
    0x2F,0x25,0x25,0x25,0x25,0x35,0x29,0x20,    //Л -                                                                                         167
    0x3F,0x31,0x31,0x31,0x31,0x31,0x31,0x20,    //П -                                                                                         168
    0x31,0x31,0x31,0x2A,0x24,0x28,0x30,0x20,    //У -                                                                                         169
    0x24,0x2E,0x35,0x35,0x35,0x2E,0x24,0x20,    //Ф                                                                                               170
    0x31,0x31,0x31,0x2F,0x21,0x21,0x21,0x20,    //Ч                                                                                               171
    0x35,0x35,0x35,0x35,0x35,0x35,0x3F,0x20,    //Ш                                                                                               172
    0x38,0x28,0x28,0x2E,0x29,0x29,0x2E,0x20,    //Ъ                                                                                               173
    0x31,0x31,0x31,0x39,0x35,0x35,0x39,0x20,    //Ы                                                                                               174
    0x2E,0x31,0x21,0x27,0x21,0x31,0x2E,0x20,    //Э -                                                                                         175
    0x32,0x35,0x35,0x39,0x35,0x35,0x32,0x20,    //Ю -                                                                                         176
    0x2F,0x31,0x31,0x2F,0x25,0x29,0x31,0x20,    //Я                                                                                               177
    0x23,0x2C,0x30,0x3E,0x31,0x31,0x2E,0x20,    //б                                                                                               178
    0x20,0x20,0x3C,0x32,0x3C,0x32,0x3C,0x20,    //в                                                                                               179
    0x20,0x20,0x3F,0x31,0x30,0x30,0x30,0x20,    //г                                                                                               180
    0x2F,0x31,0x31,0x2F,0x25,0x29,0x31,0x20,    //ё???                                                                                            181
    0x20,0x20,0x35,0x35,0x2E,0x35,0x35,0x20,    //ж                                                                                               182
    0x20,0x20,0x3E,0x21,0x26,0x21,0x3E,0x20,    //з                                                                                               183
    0x20,0x20,0x31,0x33,0x35,0x39,0x31,0x20,    //и                                                                                               184
    0x20,0x2A,0x24,0x31,0x33,0x35,0x39,0x20,    //й                                                                                               185
    0x20,0x20,0x32,0x34,0x38,0x34,0x32,0x20,    //к                                                                                               186
    0x20,0x20,0x2F,0x25,0x25,0x35,0x29,0x20,    //л                                                                                               187
    0x20,0x20,0x31,0x3B,0x35,0x31,0x31,0x20,    //м                                                                                               188
    0x20,0x20,0x31,0x31,0x3F,0x31,0x31,0x20,    //н                                                                                               189
    0x20,0x20,0x3F,0x31,0x31,0x31,0x31,0x20,    //п                                                                                               190
    0x20,0x20,0x3F,0x24,0x24,0x24,0x24,0x20,    //т -                                                                                         191
    0x20,0x20,0x31,0x31,0x2F,0x21,0x21,0x20,    //ч -                                                                                         192
    0x20,0x20,0x35,0x35,0x35,0x35,0x3F,0x20,    //ш                                                                                               193
    0x20,0x20,0x38,0x08,0x2E,0x29,0x2E,0x20,    //ъ                                                                                               194
    0x20,0x20,0x31,0x31,0x39,0x35,0x39,0x20,    //ы                                                                                               195
    0x20,0x20,0x30,0x30,0x3C,0x32,0x3C,0x20,    //ь                                                                                               196
    0x20,0x20,0x2E,0x31,0x27,0x31,0x2E,0x20,    //э                                                                                               197
    0x20,0x20,0x32,0x35,0x3D,0x35,0x32,0x20,    //ю                                                                                               198
    0x20,0x20,0x2F,0x31,0x2F,0x25,0x29,0x20,    //я                                                                                               199
    0x20,0x20,0x3C,0x32,0x3C,0x30,0x30,0x20,    //р                                                                                               200
    0x20,0x20,0x31,0x31,0x2F,0x21,0x3E,0x20,    //у                                                                                               201
    0x1F,0x1F,0x1B,0x1D,0x20,0x1D,0x1B,0x1F,    //-left	                                                                                      202
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                203
    0x20,0x20,0x20,0x1F,0x20,0x20,0x20,0x20,    //--                                                                                              204
    0x20,0x26,0x26,0x20,0x20,0x20,0x20,0x20,    //grad                                                                                            205
    0x2E,0x21,0x22,0x24,0x2F,0x20,0x20,0x20,    //m2                                                                                              206
    0x2E,0x21,0x26,0x21,0x2E,0x20,0x20,0x20,    //m3                                                                                          207
    0x20,0x20,0x3F,0x24,0x24,0x25,0x22,0x20,    // греческий- тау                                                                             208
    0x20,0x20,0x32,0x31,0x31,0x32,0x2C,0x20,    //                                                                                                209
    0x20,0x39,0x25,0x26,0x2C,0x2A,0x33,0x20,    //                                                                                                210
    0x20,0x24,0x35,0x35,0x2E,0x24,0x24,0x20,    // фи                                                                                             211
    0x20,0x20,0x2A,0x31,0x35,0x35,0x2A,0x20,    // омега                                                                                          212
    0x24,0x24,0x2A,0x2A,0x31,0x31,0x3F,0x20,    //                                                                                                213
    0x2E,0x31,0x31,0x3F,0x31,0x31,0x2E,0x20,    //                                                                                                214
    0x24,0x24,0x2A,0x2A,0x31,0x31,0x31,0x20,    //                                                                                                215
    0x3F,0x31,0x20,0x2E,0x20,0x31,0x3F,0x20,    //                                                                                                216
    0x3F,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x20,    // ПИ                                                                                             217
    0x3F,0x28,0x24,0x22,0x24,0x28,0x3F,0x20,    //                                                                                                218
    0x2A,0x35,0x35,0x24,0x24,0x24,0x24,0x20,    //                                                                                                219
    0x24,0x2E,0x35,0x35,0x35,0x2E,0x24,0x20,    //Ф                                                                                               220
    0x35,0x35,0x35,0x35,0x2E,0x24,0x24,0x20,    //                                                                                                221
    0x2E,0x31,0x31,0x31,0x2A,0x2A,0x3B,0x20,    //                                                                                                222
    0x20,0x20,0x2D,0x32,0x32,0x32,0x2D,0x20,    //альфа - малая                                                                                   223
    0x2F,0x25,0x25,0x25,0x29,0x31,0x3F,0x31,    //Д -                                                                                         224
    0x31,0x31,0x31,0x31,0x31,0x31,0x3F,0x21,    //Ц                                                                                               225
    0x35,0x35,0x35,0x35,0x35,0x35,0x3F,0x21,    //Щ                                                                                               226
    0x20,0x20,0x2F,0x25,0x29,0x31,0x3F,0x31,    //д                                                                                               227
    0x20,0x24,0x24,0x2E,0x35,0x35,0x2E,0x24,    //ф                                                                                               228
    0x20,0x20,0x31,0x31,0x31,0x31,0x3F,0x21,    //ц                                                                                               229
    0x20,0x20,0x35,0x35,0x35,0x35,0x3F,0x21,    //щ                                                                                               230
    0x20,0x22,0x35,0x35,0x2E,0x24,0x24,0x20,    //греческий- фи                                                                               231
    0x20,0x2E,0x31,0x30,0x2C,0x22,0x2C,0x20,    //греческий- сигма(мал)  дубль 0x20,0x20,0x2F,0x32,0x32,0x32,0x2C,0x20,                  232
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                233
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                234
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                235
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                236
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                237
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                238
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,    //                                                                                                239
    0x2C,0x32,0x32,0x36,0x31,0x31,0x36,0x30,    // греческие малые  beta                                                                      240
    0x20,0x20,0x39,0x29,0x29,0x2A,0x24,0x24,    //	gamma                                                                                         241
    0x26,0x29,0x24,0x2E,0x31,0x31,0x2E,0x20,    //                                                                                                242
    0x20,0x20,0x2F,0x30,0x3E,0x30,0x2F,0x20,    //                                                                                                243
    0x2F,0x22,0x2C,0x28,0x26,0x21,0x26,0x20,    //                                                                                                244
    0x20,0x36,0x29,0x29,0x29,0x29,0x21,0x20,    //                                                                                                245
    0x26,0x29,0x29,0x2F,0x29,0x29,0x26,0x20,    //                                                                                                246
    0x20,0x20,0x24,0x24,0x24,0x24,0x23,0x20,    //                                                                                                247
    0x20,0x20,0x32,0x34,0x38,0x34,0x32,0x20,    //к                                                                                               248
    0x2C,0x24,0x24,0x24,0x2A,0x2A,0x31,0x20,    //                                                                                                249
    0x20,0x20,0x32,0x32,0x32,0x3D,0x30,0x20,    //                                                                                                250
    0x20,0x20,0x33,0x31,0x32,0x34,0x28,0x20,    //                                                                                                251
    0x3F,0x24,0x28,0x27,0x28,0x30,0x2E,0x21,    //                                                                                                252
    0x20,0x20,0x3F,0x2A,0x2A,0x2A,0x33,0x20,    //                                                                                                253
    0x20,0x2E,0x31,0x31,0x31,0x3E,0x30,0x30,    // - ro                                                                                           254
    0x20,0x20,0x2F,0x32,0x32,0x32,0x2C,0x20     // греческий- сигма(мал)                                                                      255
};


static hal_lcd_text_buf_t textbuf;

// refactoring for hal abstraction

void SendBlock(const char *Src, int offset, int Size)
{
    uint end = offset + Size;
    REQUIRE(end <= sizeof(textbuf.raw));
    memcpy(&textbuf.raw[offset], Src, Size);
}

void FillLine(char vSim, char NumStr)
{
    memset(&textbuf.lines[NumStr], vSim + 0x20, sizeof(textbuf.lines[0]));
}

void SendFirstScreen(char tmSec)
{
}

void ClearGraf(void)
{
}


//-------------- Инициализировать дисплей -------

void IniLCDMem(void)
{
    FillLine(DTire,(SUM_LINE_DISP-2));   //=

    if (x_menu)
        FillLine(Tire,1);

}
void InitLCD(void)
{
    IniLCDMem();
    FillLine(Tire,1);    //-
    FillLine(0x00,7);    //Пробел
}
/*---------------------------------------------------
        Очистка буфера
----------------------------------------------------*/
void clear_d(void)
{
    unsigned char ic;
    BlkW=0;
    for (ic=0;ic<BufSize;ic++) lcdbuf[ic]=' ';
}
//---------------------------------------------------
//        Вывод буфера в индикатор
//---------------------------------------------------
void TimeToBuf(void)
{
    BlkW=1;
    Ad_Buf=PozTime;
//    buf[Ad_Buf++]=' ';
    w_int(&gd()->Hot.Time,SSdSS, 0);
    lcdbuf[Ad_Buf++]=':';
    lcdbuf[Ad_Buf++]=wtf0.Second/10+'0';
    lcdbuf[Ad_Buf++]=wtf0.Second%10+'0';
    Ad_Buf++;
    w_int(&gd()->Hot.Date,DsMsY, 0);
}

void VideoSost(void)
{
    int ic;

    BlkW=1;
    Ad_Buf=Str2d;
    for (ic=Str2d; ic < Str2; ic++) lcdbuf[ic]=' ';
    // Ad_Buf=Str4;
/*    if (ds18b20_ReadROM())
        Ad_Buf+=2;
    w_int(&Buf1W[0],StStStS, 0);
        buf[Ad_Buf++]='-';
    w_int(&Buf1W[4],StStStS, 0);
    w_int(&SumAnswers,SSSS, 0);*/
    pmInfoProg405();
    SendBlock(&lcdbuf[Str2d],TxtHomeAddr+DisplCols*(SUM_LINE_DISP-1),DisplCols);
//    pmInfoProg405();

//	w_txt(I2C1_Buffer_Tx);
//    w_txt(I2C1_Buffer_Rx);

//    w_int(&GlobData,SSSS, 0);
    //w_txt()
    //SendBlock(&buf[Str2d],TxtHomeAddr+DisplCols*(SUM_LINE_DISP-1),DisplCols);
}

void Video(void)
{
    uchar   CurRow,CurCol;
    //  if (CheckKeyboardXMEGA()) return;
    if (GrafView)
    {
        GrafView--;
        if (!GrafView)
            ClearGraf();
        else
            return;
    }

    // draw hbars at line 1, line 6
    IniLCDMem();

    // draw line 0 - time etc
    TimeToBuf();
    SendBlock(&lcdbuf[0],TxtHomeAddr,DisplCols);

    // draw line 2, 3, 4, 5
    SendBlock(&lcdbuf[Str2],TxtHomeAddr+DisplCols*2,DisplCols*(SUM_LINE_DISP-4));

//-- установить курсор --
    CurCol=(AdinB+Mark) % DisplCols;
    CurRow=(AdinB+Mark) / DisplCols;// + 2;

    HAL_lcd_position_cursor(CurCol, CurRow, wtf0.Menu ? 8 : 3, 1);

    // draw line 6 (last line) - sensors values
    VideoSost();

    HAL_lcd_render_ugly_encoded_text(&textbuf);
}
